---
id: vs
title: H5性能对比
---

## 业务背景
快影的上热门 Tab 点击进去之后的全屏播放页，起初是用 H5 实现，开发完毕之后发现 H5 的体验不太好，遂用 RN 重新实现了一遍，体验起来好很多

![](../static/img/popular.png)

RN 是在快影下初次使用，其性能指标需要验证。刚好有一个业务使用了两种技术进行开发，所以借这个场景对 RN 和 H5 进行一次技术指标的对比


本次主要对比了三个业务场景：首次打开、二次打开和滑动视频

测试环境：iPhone7P，iOS13.3；快影 5.6.1；Android 9，vivo x27；快影 5.3.0；

测试工具：使用 Perfdog 和 Xcode  测试内存；iOS使用 stagesepx 测试渲染时间和起播时间，Android使用录屏取两帧间隔计算渲染时间和启播时间。

## 首次打开

iOS
|     | 渲染时间（秒）| 内存占用（M） | 内存涨幅（M）
|  ----  | ----  |  ----  | ----  |
| H5  | 1.15 | 155 | 6 | 
| RN  | 0.45 | 161 | 19 |

Android
|     | 渲染时间（秒）| 内存占用（M） | 内存涨幅（M）
|  ----  | ----  |  ----  | ----  |
| H5  | 1.600 | 517 | 63 | 
| RN  | 1.067 | 498 | 40 |

可以看到，首次打开时，在渲染时间上，RN 占有优势；但是iOS上 RN 的内存涨幅比 H5 高许多，Android RN内存占用稍低于H5

## 二次打开

iOS
|     | 渲染时间（秒）| 内存占用（M） | 内存涨幅（M）
|  ----  | ----  |  ----  | ----  |
| H5  | 1.23 | 155 | 2 | 
| RN  | 0.19 | 161 | 2 |

Android
|     | 渲染时间（秒）| 内存占用（M） | 内存涨幅（M）
|  ----  | ----  |  ----  | ----  |
| H5  | 1.766 | 513 | 36 | 
| RN  | 1.067 | 498 | 35 |

可以看到，二次打开时，在渲染时间上，RN 依然占有优势；其他指标都差不多。因为这里 RN 有对 RCTBridge 做了缓存，所以内存涨幅相比第一次就减少许多。Android RN内存占用与H5一致

## 滑动视频

iOS
|     | 起播时间（秒）| 内存占用（M） | 内存峰值（M） | FPS | CPU | 10秒内卡顿次数
|  ----  |  ----  |  ----  |  ----  |  ----  |  ----  |  ----  |
| H5  | 2.4 | 147.6 | 148.3 | 38.8 | 2.73% | 421.7 |
| RN  | 0.5 | 169.1 | 176.7 | 47.1 | 11.67% | 163.3 |

Android
|     | 起播时间（秒）| 内存占用（M） | 内存峰值（M） | FPS | CPU | 10秒内卡顿次数
|  ----  |  ----  |  ----  |  ----  |  ----  |  ----  |  ----  |
| H5  | 0.6 | 563.7 | 596 | 41.6 | 9.6% | 313.0 |
| RN  | 0.4 | 603.6 | 671 | 38.1 | 11.67% | 177.7 |


可以看到，滑动视频时，RN 的渲染速度十分快，而内存占用也较多一些。因为 RN 使用了 ScrollView 来实现列表滑动，各个子 View 同时存在内存中，因此内存上有劣势而时间上有优势；每次滑动需要重新渲染各个子 View，因而 CPU 上占用多些。其他指标诸如 FPS、卡顿，RN 都占优些。

## 其他指标
1. iOS包大小：使用 RN 之前包体积是 141M，使用 RN 之后是 145 M，

> 这里的包体积指的是 download size，即用户在 AppStore 下载前看到的 Size

2. Android包大小：集成KRN之前70.3M，集成之后是72.2M，一共增量1.9M（包括JS业务包）。

3. 开发时间：前端同学先用两周时间开发了 H5 版本，再用 1 周时间开发了 RN；整体花在开发上的时间差不多，但是相对来说，RN 性能好一些，节省了优化的时间；其次业务是相同的，RN 是后开发的，避免了一些坑

## 测试小结
相对于 H5，RN 的优势：

1. 页面渲染快很多；
2. 滑动时起播速度快很多 
3. 页面帧率较高，卡顿较少

RN 的劣势：

1. 内存占用较高（RN 框架本身占用的内存，以及业务使用了 ScrollView）
2. CPU 占用较多（每次滑动需要渲染整个 ScrollView）

## 未来展望
RN 初次接入快影 App，尚在完善当中，首先有很多基础能力和基础组件需要补全、梳理；其次针对已有的性能问题，未来需要加强性能方面的测试和探索优化，比如使用在某些业务场景下使用 FlatList 代替 ScrollView 减轻内存压力等等




